# ğŸ—ï¸ Diagramma Architettura Sistema Coworking

## ğŸ“Š Schema Visuale Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                ğŸŒ FRONTEND (Client)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ“„ HTML       â”‚  â”‚   ğŸ¨ CSS        â”‚  â”‚   âš¡ JavaScript â”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ index.html    â”‚  â”‚ â€¢ style.css     â”‚  â”‚ â€¢ main.js       â”‚                â”‚
â”‚  â”‚ â€¢ catalogo.html â”‚  â”‚ â€¢ modern-design â”‚  â”‚ â€¢ config.js     â”‚                â”‚
â”‚  â”‚ â€¢ selezione-    â”‚  â”‚ â€¢ selezione-    â”‚  â”‚ â€¢ selezione-    â”‚                â”‚
â”‚  â”‚   slot.html     â”‚  â”‚   slot.css      â”‚  â”‚   slot.js       â”‚                â”‚
â”‚  â”‚ â€¢ pagamento.htmlâ”‚  â”‚ â€¢ catalog.css   â”‚  â”‚ â€¢ slot-manager  â”‚                â”‚
â”‚  â”‚ â€¢ dashboard.htmlâ”‚  â”‚ â€¢ dashboard.css â”‚  â”‚ â€¢ pagamento.js  â”‚                â”‚
â”‚  â”‚ â€¢ login.html    â”‚  â”‚                 â”‚  â”‚ â€¢ auth-modal.js â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ HTTP/HTTPS + SSE
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              âš™ï¸ BACKEND (Server)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸš€ Express    â”‚  â”‚   ğŸ›¡ï¸ Middleware â”‚  â”‚   ğŸ® Controllersâ”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ app.js        â”‚  â”‚ â€¢ auth.js       â”‚  â”‚ â€¢ authControllerâ”‚                â”‚
â”‚  â”‚ â€¢ CORS          â”‚  â”‚ â€¢ sseAuth.js    â”‚  â”‚ â€¢ catalogoCtrl  â”‚                â”‚
â”‚  â”‚ â€¢ Static Files  â”‚  â”‚ â€¢ Validation    â”‚  â”‚ â€¢ prenotazioni  â”‚                â”‚
â”‚  â”‚ â€¢ Error Handler â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ pagamentiCtrl â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ›£ï¸ Routes     â”‚  â”‚   ğŸ”§ Services   â”‚  â”‚   â° Cron Jobs  â”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ /api/auth     â”‚  â”‚ â€¢ scadenzeSvc   â”‚  â”‚ â€¢ scadenzeCron  â”‚                â”‚
â”‚  â”‚ â€¢ /api/catalogo â”‚  â”‚ â€¢ slotTimerSvc  â”‚  â”‚ â€¢ cleanupJobs   â”‚                â”‚
â”‚  â”‚ â€¢ /api/prenotaz â”‚  â”‚ â€¢ analyticsSvc  â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ /api/pagamentiâ”‚  â”‚ â€¢ notificationSvcâ”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ /api/sse      â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ /webhook      â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ PostgreSQL Queries
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ğŸ—„ï¸ DATABASE (PostgreSQL)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ‘¥ Users      â”‚  â”‚   ğŸ¢ Business   â”‚  â”‚   ğŸ“… Bookings   â”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ users         â”‚  â”‚ â€¢ sedi          â”‚  â”‚ â€¢ prenotazioni  â”‚                â”‚
â”‚  â”‚ â€¢ gestori       â”‚  â”‚ â€¢ spazi         â”‚  â”‚ â€¢ slot_timer    â”‚                â”‚
â”‚  â”‚ â€¢ responsabili  â”‚  â”‚ â€¢ servizi       â”‚  â”‚ â€¢ scadenze      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ’³ Payments   â”‚  â”‚   ğŸ“Š Analytics  â”‚  â”‚   ğŸ”§ System     â”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ pagamenti     â”‚  â”‚ â€¢ analytics_    â”‚  â”‚ â€¢ migrations    â”‚                â”‚
â”‚  â”‚ â€¢ stripe_       â”‚  â”‚   events        â”‚  â”‚ â€¢ seeds         â”‚                â”‚
â”‚  â”‚   customers     â”‚  â”‚ â€¢ ab_testing    â”‚  â”‚ â€¢ backups       â”‚                â”‚
â”‚  â”‚ â€¢ stripe_       â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚   payments      â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ API Calls
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŒ EXTERNAL SERVICES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ’³ Stripe     â”‚  â”‚   ğŸ“§ Email      â”‚  â”‚   ğŸ“± SMS        â”‚                â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚  â”‚ â€¢ Payment API   â”‚  â”‚ â€¢ Notifications â”‚  â”‚ â€¢ OTP Codes     â”‚                â”‚
â”‚  â”‚ â€¢ Webhooks      â”‚  â”‚ â€¢ Confirmations â”‚  â”‚ â€¢ Alerts        â”‚                â”‚
â”‚  â”‚ â€¢ Customer Mgmt â”‚  â”‚ â€¢ Reminders     â”‚  â”‚                 â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flussi di Comunicazione

### **1. Flusso di Prenotazione:**
```
ğŸ‘¤ Utente
  â”‚
  â–¼
ğŸŒ Frontend (selezione-slot.html)
  â”‚ HTTP GET /api/spazi/{id}/disponibilita-slot/{data}
  â–¼
âš™ï¸ Backend (spaziController.js)
  â”‚ SELECT * FROM slot_timer WHERE data = ?
  â–¼
ğŸ—„ï¸ Database (PostgreSQL)
  â”‚ JSON response
  â–¼
âš™ï¸ Backend
  â”‚ JSON response
  â–¼
ğŸŒ Frontend (SlotManager)
  â”‚ updateSlotButton()
  â–¼
ğŸ‘¤ Utente (UI aggiornata)
```

### **2. Flusso Real-time (SSE):**
```
ğŸ—„ï¸ Database (Trigger/Event)
  â”‚
  â–¼
âš™ï¸ Backend (sseController.js)
  â”‚ broadcast(event)
  â–¼
ğŸŒ Frontend (EventSource)
  â”‚ onmessage
  â–¼
ğŸŒ Frontend (SlotManager)
  â”‚ handleSlotUpdate()
  â–¼
ğŸ‘¤ Utente (UI real-time)
```

### **3. Flusso di Pagamento:**
```
ğŸ‘¤ Utente (pagamento.html)
  â”‚
  â–¼
ğŸŒ Frontend (pagamento.js)
  â”‚ POST /api/pagamenti
  â–¼
âš™ï¸ Backend (pagamentiController.js)
  â”‚ stripe.paymentIntents.create()
  â–¼
ğŸ’³ Stripe API
  â”‚ Webhook /webhook/stripe
  â–¼
âš™ï¸ Backend (webhook.js)
  â”‚ UPDATE prenotazioni SET stato = 'confermata'
  â–¼
ğŸ—„ï¸ Database
  â”‚ SSE broadcast
  â–¼
ğŸŒ Frontend (conferma)
```

## ğŸ¯ Architettura a Livelli

### **Livello 1: Presentazione (Frontend)**
- **ResponsabilitÃ **: UI/UX, interazione utente
- **Tecnologie**: HTML5, CSS3, JavaScript
- **Comunicazione**: HTTP/HTTPS, Server-Sent Events

### **Livello 2: Logica Business (Backend)**
- **ResponsabilitÃ **: Regole business, validazione, orchestrazione
- **Tecnologie**: Node.js, Express.js
- **Comunicazione**: REST API, WebSocket-like (SSE)

### **Livello 3: Persistenza (Database)**
- **ResponsabilitÃ **: Storage dati, transazioni, integritÃ 
- **Tecnologie**: PostgreSQL
- **Comunicazione**: SQL queries, connection pooling

### **Livello 4: Servizi Esterni**
- **ResponsabilitÃ **: Pagamenti, notifiche, analytics
- **Tecnologie**: Stripe, Email providers, SMS services
- **Comunicazione**: REST API, Webhooks

## ğŸ” Sicurezza e Autenticazione

```
ğŸ‘¤ Utente
  â”‚ Login credentials
  â–¼
ğŸŒ Frontend (auth-modal.js)
  â”‚ POST /api/auth/login
  â–¼
âš™ï¸ Backend (authController.js)
  â”‚ bcrypt.compare(password, hash)
  â–¼
ğŸ—„ï¸ Database (users table)
  â”‚ JWT.sign(user)
  â–¼
âš™ï¸ Backend
  â”‚ Set-Cookie: token
  â–¼
ğŸŒ Frontend (localStorage)
  â”‚ Authorization: Bearer token
  â–¼
âš™ï¸ Backend (auth middleware)
  â”‚ jwt.verify(token)
  â–¼
ğŸ® Controller (authorized request)
```

## ğŸ“Š Monitoraggio e Logging

```
ğŸŒ Frontend
  â”‚ console.log('User action:', action)
  â–¼
âš™ï¸ Backend
  â”‚ console.log('API call:', endpoint)
  â”‚ analytics.track(event)
  â–¼
ğŸ—„ï¸ Database
  â”‚ Log slow queries
  â”‚ Monitor connections
  â–¼
ğŸŒ External Services
  â”‚ Stripe logs
  â”‚ Email delivery status
```

---

*Diagramma creato: Dicembre 2024*
*Versione: 1.0 - Architettura Visuale*
